name: Java CI

on: 
  # Se activa con pushes a la rama main
  push:
    branches: [ main ] 
  
  # Se activa con Pull Requests dirigidos a main
  pull_request:
    branches: [ main ]

jobs: 
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout del código
        uses: actions/checkout@v3

      - name: Configurar JDK
        # Instala Java 17 (Temurin)
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Compilar el proyecto
        run: javac src/Calculadora.java test/CalculadoraTest.java

      - name: Ejecutar pruebas
        # CORREGIDO: Añadimos -ea para activar las assertions y forzar la falla.
        run: java -ea -cp .:src:test test.CalculadoraTest
        
      - name: Notificar en Slack si falla
        uses: rtCamp/action-slack-notify@v2
        if: ${{ failure() }} # Solo se ejecuta si el pipeline falla
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
          SLACK_TITLE: Fallo en el Pipeline de Java CI ❌
          SLACK_MESSAGE: El Job 'Build' ha fallado al ejecutar las pruebas.
          SLACK_USERNAME: GitHub Actions Bot
          SLACK_ICON: https://github.com/github.png